-- ==================== 陈某脚本 - WindUI 版（完整功能 + 全部 Tab + ESP + 碰撞箱 + 飞行v3） ====================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local LP = Players.LocalPlayer

-- 加载 WindUI
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

-- ============== 注入器检测器（修复版，无递归） ==============
local function identifyexecutor()
    if getexecutorname then 
        return getexecutorname() 
    end
    
    local signals = {"syn", "fluxus", "krnl", "solara", "wave", "xeno", "scriptware", "electron", "delta", "hydrogen"}
    for _, sig in ipairs(signals) do
        if getgenv()[sig] then 
            return sig:upper() .. " Executor" 
        end
    end
    
    if gethui then 
        return "KRNL / Solara (L7+)" 
    end
    
    if http_request and not pcall(function() return game:GetService("HttpService") end) then 
        return "Fluxus / Free 中端" 
    end
    
    if hookmetamethod and setreadonly then 
        return "Synapse X / Script-Ware / Wave 高端" 
    end
    
    if getcustomasset then 
        return "Xeno / Arceus X / Hydrogen" 
    end
    
    if getgenv().isexecutor then 
        return "Delta / Trigon 移动端" 
    end
    
    local mt = getrawmetatable(game)
    if hookfunction and mt and mt.__namecall then 
        return "Wave / Cryptic / 高隐蔽" 
    end
    
    return "Unknown (L6以下 / 自定义 / 未注入)"
end

getgenv().CurrentExecutor = identifyexecutor()
print("陈某脚本检测: " .. getgenv().CurrentExecutor)

-- 渐变文本函数
local function gradient(text, startColor, endColor)
    local result = ""
    local chars = {}
    
    for uchar in text:gmatch("[%z\1-\127\194-\244][\128-\191]*") do
        table.insert(chars, uchar)
    end
    
    local length = #chars
    
    for i = 1, length do
        local t = (i - 1) / math.max(length - 1, 1)
        local r = startColor.R + (endColor.R - startColor.R) * t
        local g = startColor.G + (endColor.G - startColor.G) * t
        local b = startColor.B + (endColor.B - startColor.B) * t
        
        result = result .. string.format('<font color="rgb(%d,%d,%d)">%s</font>', 
            math.floor(r * 255), 
            math.floor(g * 255), 
            math.floor(b * 255), 
            chars[i])
    end
    
    return result
end

-- 创建主窗口
local Window = WindUI:CreateWindow({
    Title = gradient("陈某脚本", Color3.fromHex("#000080"), Color3.fromHex("#00FFFF")), 
    Author = gradient("陈某", Color3.fromHex("#00FFAA"), Color3.fromHex("#00AAFF")),
    Icon = "rbxassetid://129260712070622",
    IconThemed = true,
    Folder = "ChenMoScript",
    Size = UDim2.fromOffset(500, 380),
    Transparent = true,
    Theme = "Sky",
    SideBarWidth = 200,
    HideSearchBar = false,
    ScrollBarEnabled = true,
})

-- 修改打开按钮
Window:EditOpenButton({
    Title = "打开陈某脚本",
    Icon = "monitor",
    CornerRadius = UDim.new(1, 10),
    StrokeThickness = 5,
    Color = ColorSequence.new(
        Color3.fromHex("#00AAFF"),
        Color3.fromHex("#00FFAA")
    ),
    Draggable = true,
})

-- =====================
--  通用 Tab（公告）
-- =====================
local MainTab = Window:Tab({
    Title = "公告",
    Icon = "zap",
    Locked = false,
})

MainTab:Paragraph({
    Title = "更新公告",
    Desc = "增加了tx v3和注入器检查",
})

MainTab:Paragraph({
    Title = "当前注入器",
    Desc = "检测结果: **" .. getgenv().CurrentExecutor .. "**\n(点击通用Tab可刷新)",
})

-- =====================
--  通用 Tab
-- =====================
local MainTab = Window:Tab({
    Title = "通用",
    Icon = "zap",
    Locked = false,
})

MainTab:Paragraph({
    Title = "欢迎使用陈某脚本",
    Desc = "作者：陈某 | QQ群: 632620595\n完整功能已就绪",
})

MainTab:Button({
    Title = "复制 QQ 群号",
    Icon = "copy",
    Callback = function()
        setclipboard("632620595")
        WindUI:Notify({
            Title = "已复制",
            Content = "QQ群号已复制到剪贴板",
            Duration = 3
        })
    end
})

-- 无限跳
local infJumpConn
MainTab:Toggle({
    Title = "无限跳跃",
    Default = false,
    Callback = function(v)
        if v then
            infJumpConn = UserInputService.JumpRequest:Connect(function()
                local hum = LP.Character and LP.Character:FindFirstChildOfClass("Humanoid")
                if hum then hum:ChangeState(Enum.HumanoidStateType.Jumping) end
            end)
        else
            if infJumpConn then infJumpConn:Disconnect() end
        end
    end
})

-- 移动速度
MainTab:Slider({
    Title = "移动速度",
    Value = {Min = 16, Max = 400, Default = 16},
    Increment = 1,
    Callback = function(value)
        local hum = LP.Character and LP.Character:FindFirstChildOfClass("Humanoid")
        if hum then hum.WalkSpeed = value end
    end
})

-- 重力
MainTab:Slider({
    Title = "重力",
    Value = {Min = 0, Max = 500, Default = Workspace.Gravity},
    Increment = 1,
    Callback = function(value)
        Workspace.Gravity = value
    end
})

-- 无限血
MainTab:Toggle({
    Title = "无限血 (God Mode)",
    Default = false,
    Callback = function(v)
        if v then
            getgenv().GodConn = RunService.Heartbeat:Connect(function()
                local hum = LP.Character and LP.Character:FindFirstChildOfClass("Humanoid")
                if hum and hum.Health < hum.MaxHealth then hum.Health = hum.MaxHealth end
            end)
        else
            if getgenv().GodConn then getgenv().GodConn:Disconnect() end
        end
    end
})

-- FOV
MainTab:Slider({
    Title = "广角 (FOV)",
    Value = {Min = 30, Max = 120, Default = 70},
    Increment = 1,
    Callback = function(value)
        workspace.CurrentCamera.FieldOfView = value
    end
})

-- 夜视
MainTab:Toggle({
    Title = "夜视模式",
    Default = false,
    Callback = function(v)
        if v then
            Lighting.Ambient = Color3.new(1,1,1)
            Lighting.ColorShift_Bottom = Color3.new(1,1,1)
            Lighting.ColorShift_Top = Color3.new(1,1,1)
        else
            Lighting.Ambient = Color3.new(0,0,0)
            Lighting.ColorShift_Bottom = Color3.new(0,0,0)
            Lighting.ColorShift_Top = Color3.new(0,0,0)
        end
    end
})

-- 飞行v3
MainTab:Button({
    Title = "加载飞行v3",
    Callback = function()
        local url = "https://raw.githubusercontent.com/g06721842-bit/hjhhgvg/main/%E9%A3%9E%E8%A1%8Cv3"
        local success, content = pcall(game.HttpGet, game, url, true)
        if success and content then
            loadstring(content)()
            WindUI:Notify({Title = "成功", Content = "飞行v3 已加载", Duration = 3})
        else
            WindUI:Notify({Title = "失败", Content = "飞行v3 加载失败", Duration = 5})
        end
    end
})

MainTab:Button({
     Title = "Dex",
     Callback = function()
        loadstring(game:HttpGet("https://gitee.com/cmbhbh/cmbh/raw/master/Bex.lua"))()
        WindUI:Notify({Title = "通用", Content = "Dex", Duration = 3})
     end
})

MainTab:Button({
    Title = "甩飞",
    Callback = function()
       loadstring(game:HttpGet(('https://raw.githubusercontent.com/0Ben1/fe/main/obf_5wpM7bBcOPspmX7lQ3m75SrYNWqxZ858ai3tJdEAId6jSI05IOUB224FQ0VSAswH.lua.txt'),true))()
       WindUI:Notify({Title = "通用",Content = "甩飞已加载",Duration =3})
    end
})
-- =====================
--  枪战 Tab（碰撞箱）
-- =====================
local GunTab = Window:Tab({
    Title = "枪战",
    Icon = "crosshair",
    Locked = false,
})

local HitboxEnabled = false
local HitboxConnections = {}

local function processCharacter(character)
    if not character then return end
    local hrp = character:WaitForChild("HumanoidRootPart", 8)
    if not hrp then return end

    local upperTorso = character:FindFirstChild("UpperTorso")
    local head = character:FindFirstChild("Head")

    if HitboxEnabled then
        if upperTorso and upperTorso:IsA("BasePart") then
            upperTorso.CanCollide = false
            upperTorso.Transparency = 0.6
            upperTorso.Size = Vector3.new(21, 21, 21)
        end
        if head and head:IsA("BasePart") then
            head.CanCollide = false
            head.Transparency = 0.6
            head.Size = Vector3.new(21, 21, 21)
        end
        if hrp and hrp:IsA("BasePart") then
            hrp.CanCollide = false
            hrp.Transparency = 0.6
            hrp.Size = Vector3.new(21, 21, 21)
        end
    end
end

local function setupPlayer(player)
    if player == LP then return end
    if player.Character then processCharacter(player.Character) end
    local conn = player.CharacterAdded:Connect(processCharacter)
    table.insert(HitboxConnections, conn)
end

local function ToggleHitbox(v)
    HitboxEnabled = v
    if v then
        for _, player in ipairs(Players:GetPlayers()) do
            setupPlayer(player)
        end
        WindUI:Notify({Title = "碰撞箱", Content = "已启用（21x21x21）", Duration = 3})
    else
        for _, conn in ipairs(HitboxConnections) do conn:Disconnect() end
        HitboxConnections = {}
        WindUI:Notify({Title = "碰撞箱", Content = "已关闭", Duration = 3})
    end
end

Players.PlayerAdded:Connect(function(player)
    if HitboxEnabled then setupPlayer(player) end
end)

GunTab:Toggle({
    Title = "启用大碰撞箱（FFA）",
    Default = false,
    Callback = ToggleHitbox
})

GunTab:Paragraph({
    Title = "碰撞箱说明",
    Desc = "开启后其他玩家 Hitbox 扩大为 21×21×21\n禁用碰撞 + 半透明\n适用于 FFA 模式",
})

-- =====================
--  刀刃球 Tab
-- =====================
local BladeTab = Window:Tab({
    Title = "刀刃球",
    Icon = "swords",
    Locked = false,
})

BladeTab:Button({
    Title = "加载格挡 V4",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Hosvile/Refinement/main/MC%3ABlade%20Ball%20Parry%20V4.0.0"))()
        WindUI:Notify({Title = "刀刃球", Content = "格挡 V4 已加载", Duration = 3})
    end
})

-- =====================
--  缝合脚本 Tab
-- =====================
local SeamTab = Window:Tab({
    Title = "缝合脚本",
    Icon = "puzzle",
    Locked = false,
})

SeamTab:Button({
    Title = "加载 Infinite Yield",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
        WindUI:Notify({Title = "缝合", Content = "IY 已加载", Duration = 3})
    end
})

SeamTab:Button({
    Title = "加载 XK Hub",
    Callback = function()
        loadstring(game:HttpGet("https://github.com/devslopo/DVES/raw/main/XK%20Hub"))()
        WindUI:Notify({Title = "缝合", Content = "XK 已加载", Duration = 3})
    end
})

SeamTab:Button({
    Title = "加载寒脚本",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/135246508623/protection/refs/heads/main/Han%20hub"))()
        WindUI:Notify({Title = "缝合", Content = "寒脚本已加载", Duration = 3})
    end
})

SeamTab:Button({
    Title = "皮脚本",
    Callback =function()
        getgenv().XiaoPi="皮脚本QQ群849852804" loadstring(game:HttpGet("https://raw.githubusercontent.com/xiaopi77/xiaopi77/main/QQ1002100032-Roblox-Pi-script.lua"))()
        WindUI:Notify({Title = "缝合", Content = "皮脚本已加载", Duration = 3})
    end
})

SeamTab:Button({
     Title = "tx v3",
     Callback =function()
         -- 修正：Game → game（小写）
         loadstring(game:HttpGet("https://raw.githubusercontent.com/JsYb666/TX-Free/refs/heads/main/TX-V3.0"))()
         WindUI:Notify({Title = "缝合", Content = "tx v3已加载", Duration = 3})
     end
})

-- =====================
--  战场脚本 Tab
-- =====================
local BattlefieldTab = Window:Tab({
    Title = "战场脚本",
    Icon = "sword",
    Locked = false,
})

BattlefieldTab:Button({
    Title = "加载无敌垃圾桶",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/yes1nt/yes/refs/heads/main/Trashcan%20Man"))()
        WindUI:Notify({Title = "战场", Content = "无敌垃圾桶已加载", Duration = 3})
    end
})

BattlefieldTab:Button({
     Title = "加载幻象脚本",
     Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/ke9460394-dot/ugik/refs/heads/main/phantasm.lua"))()
        WindUI:Notify({Title = "战场", Content = "幻象脚本", Duration = 3})
     end
})

-- =====================
--  lc Tab
-- =====================
local LcTab = Window:Tab({
    Title = "lc",
    Icon = "user",
    Locked = false,
})

LcTab:Button({
    Title = "加载 LC 脚本",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/yuanshenqdon/Script/refs/heads/main/LC.lua"))()
        WindUI:Notify({Title = "LC", Content = "LC 脚本已加载", Duration = 3})
    end
})

LcTab:Button({
  Title = "加载lc脚本",
  Callback = function()
     loadstring(game:HttpGet("https://scriptblox.com/script/Lexington-and-Concord-Lexington-Concord-105785"))()
     WindUI:Notify({Title = "lc", Content = "lc脚本已加载", Duration = 3})
  end
})

-- =====================
--  游戏脚本 Tab
-- =====================
local GameTab = Window:Tab({
     Title = "游戏脚本",
     Icon = "drama",
     Locked = false,   -- 修正：Local → Locked（假设是笔误）
})

GameTab:Button({
     Title = "加载逃离海啸，获取红脑(无敌)",
     Callback = function()
         loadstring(game:HttpGet("https://api.luarmor.net/files/v4/loaders/d8185b175524d935b4a6026c784375fc.lua"))()
         WindUI:Notify({Title = "游戏脚本", Content = "逃离海啸脚本已加载", Duration = 3})
     end
})

GameTab:Button({
     Title = "Ohio",
     Callback = function()
        loadstring(game:HttpGet("https://pastebin.com/raw/YUn7uTxt"))()
        WindUI:Notify({Title = "游戏脚本", Content = "Ohio已加载", Duration = 3})
     end
})