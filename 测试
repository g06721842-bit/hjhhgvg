-- k00pkidd770 gui f3x （防踢优化版：超慢循环 + 全局冷却）

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "k00pkidd770_gui_f3x"
ScreenGui.Parent = game.CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- 全局冷却（防止快速连点多个功能导致 spam 被踢）
local GlobalCooldown = false
local CooldownTime = 8  -- 秒，建议别调太小

-- 循环指令管理表（间隔已大幅拉长，降低检测风险）
local Loops = {
    fire = {
        btn = nil,
        active = false,
        cmd = ";fire all",
        interval = 30,          -- 每30秒一次，防踢
        text = "全员着火"
    },
    disco = {
        btn = nil,
        active = false,
        cmd = ";disco",
        interval = 45,
        text = "迪斯科 / 彩虹灯"
    },
    charall = {
        btn = nil,
        active = false,
        cmd = ";char all k00pkid770",
        interval = 60,          -- 变身指令最危险，60秒起步
        text = "全员变身"
    },
    -- 如果想加更多循环项，例如提示消息：
    -- hint = { btn = nil, active = false, cmd = ";sh join team k00pkid770 today!!!", interval = 90, text = "顶部提示" },
}

-- 统一切换循环函数（带全局冷却）
local function toggleLoop(key)
    if GlobalCooldown then
        warn("全局冷却中，请等待 " .. CooldownTime .. " 秒")
        return
    end

    GlobalCooldown = true
    task.delay(CooldownTime, function() GlobalCooldown = false end)

    local data = Loops[key]
    if not data or not data.btn then return end

    data.active = not data.active

    if data.active then
        data.btn.Text = data.text .. " (ON)"
        task.spawn(function()
            while data.active do
                local success, err = pcall(function()
                    local RequestCommand = game:GetService("ReplicatedStorage"):WaitForChild("HDAdminHDClient", 5)
                    if RequestCommand then
                        local signal = RequestCommand:WaitForChild("Signals", 5):WaitForChild("RequestCommandSilent", 5)
                        if signal then
                            signal:InvokeServer(data.cmd)
                        end
                    end
                end)
                if not success then
                    warn("HD指令执行失败: " .. tostring(err))
                end
                task.wait(data.interval)
            end
            -- 结束时恢复文字
            if data.btn and data.btn.Parent then
                data.btn.Text = data.text
            end
        end)
    else
        data.btn.Text = data.text .. " (OFF)"
        task.delay(1, function()
            if data.btn and data.btn.Parent and data.btn.Text:find("(OFF)") then
                data.btn.Text = data.text
            end
        end)
    end
end

-- 主框架
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.Size = UDim2.new(0, 500, 0, 450)
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -225)
MainFrame.Active = true
MainFrame.Draggable = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

-- 标题
local ScriptTitle = Instance.new("TextLabel")
ScriptTitle.Name = "ScriptTitle"
ScriptTitle.Parent = MainFrame
ScriptTitle.BackgroundTransparency = 1
ScriptTitle.Position = UDim2.new(0, 100, 0, 7)
ScriptTitle.Size = UDim2.new(0, 300, 0, 32)
ScriptTitle.Font = Enum.Font.GothamBold
ScriptTitle.Text = "k00pkid770 gui f3x (防踢版)"
ScriptTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
ScriptTitle.TextSize = 16

-- Glow 效果
local function MakeGlow(button)
    local originalColor = Color3.fromRGB(50, 50, 50)
    button.MouseButton1Down:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        button.TextColor3 = Color3.fromRGB(0, 0, 0)
    end)
    button.MouseButton1Up:Connect(function()
        button.BackgroundColor3 = originalColor
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
    end)
end

-- 创建按钮函数
local function CreateBtn(name, pos, size)
    local btn = Instance.new("TextButton")
    btn.Name = name .. "Btn"
    btn.Parent = MainFrame
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.Position = pos
    btn.Size = size
    btn.Font = Enum.Font.GothamBold
    btn.Text = name
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 10
    btn.AutoButtonColor = false
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = btn
    MakeGlow(btn)
    return btn
end

-- 创建所有按钮
local BtoolsBtn = CreateBtn("B工具 / 建筑工具", UDim2.new(0, 7, 0, 7), UDim2.new(0, 95, 0, 32))
local ReBtn = CreateBtn("重生 / 重置", UDim2.new(1, -102, 0, 7), UDim2.new(0, 95, 0, 32))
local bSize = UDim2.new(0, 115, 0, 55)
local DecalBtn = CreateBtn("贴图轰炸 / 全图贴图", UDim2.new(0, 10, 0, 65), bSize)
local SkyboxBtn = CreateBtn("天空盒 / 旋转天空", UDim2.new(0, 133, 0, 65), bSize)
local R6Btn = CreateBtn("R6", UDim2.new(0, 256, 0, 65), bSize)
local HintBtn = CreateBtn("顶部提示", UDim2.new(0, 379, 0, 65), bSize)
local MessageBtn = CreateBtn("全屏消息", UDim2.new(0, 10, 0, 130), bSize)
local CharAllBtn = CreateBtn("全员变身", UDim2.new(0, 133, 0, 130), bSize)
local DiscoBtn = CreateBtn("迪斯科 / 彩虹灯", UDim2.new(0, 256, 0, 130), bSize)
local FireAllBtn = CreateBtn("全员着火", UDim2.new(0, 379, 0, 130), bSize)

-- music 标题
local MusicLabel = Instance.new("TextLabel")
MusicLabel.Parent = MainFrame
MusicLabel.BackgroundTransparency = 1
MusicLabel.Position = UDim2.new(0, 0, 0, 185)
MusicLabel.Size = UDim2.new(1, 0, 0, 100)
MusicLabel.Font = Enum.Font.GothamBold
MusicLabel.Text = "music"
MusicLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
MusicLabel.TextSize = 85

-- 第三行音乐按钮
local y3 = 285
local ThemeMeBtn = CreateBtn("主题音乐1", UDim2.new(0, 10, 0, y3), bSize)
local JumpstyleBtn = CreateBtn("跳跃舞曲", UDim2.new(0, 133, 0, y3), bSize)
local ToxicBtn = CreateBtn("毒性音乐", UDim2.new(0, 256, 0, y3), bSize)
local WtfGoobyBtn = CreateBtn("诡异慢速音乐", UDim2.new(0, 379, 0, y3), bSize)

-- 绑定按钮到 Loops
Loops.fire.btn    = FireAllBtn
Loops.disco.btn   = DiscoBtn
Loops.charall.btn = CharAllBtn
-- Loops.hint.btn = HintBtn  -- 如果加了 hint 就取消注释

-- HD 指令快捷函数（加 pcall 防报错）
local function HD(cmd)
    pcall(function()
        local RequestCommand = game:GetService("ReplicatedStorage"):WaitForChild("HDAdminHDClient", 5)
        if RequestCommand then
            local signal = RequestCommand:WaitForChild("Signals", 5):WaitForChild("RequestCommandSilent", 5)
            if signal then
                signal:InvokeServer(cmd)
            end
        end
    end)
end

-- 事件绑定
FireAllBtn.MouseButton1Click:Connect(function() toggleLoop("fire") end)
DiscoBtn.MouseButton1Click:Connect(function() toggleLoop("disco") end)
CharAllBtn.MouseButton1Click:Connect(function() toggleLoop("charall") end)

-- 单次按钮
BtoolsBtn.MouseButton1Click:Connect(function() HD(";btools me") end)
ReBtn.MouseButton1Click:Connect(function() HD(";re") end)
R6Btn.MouseButton1Click:Connect(function() HD(";r6") end)
HintBtn.MouseButton1Click:Connect(function() HD(";sh join team k00pkid770 today!!!") end)
MessageBtn.MouseButton1Click:Connect(function() HD(";sm join team k00pkid770 today!!!") end)

-- Decal 轰炸（原版，危险操作，慎用）
DecalBtn.MouseButton1Click:Connect(function()
    local player = game.Players.LocalPlayer
    local tool
    for _, v in player:GetDescendants() do if v.Name == "SyncAPI" then tool = v.Parent end end
    for _, v in game.ReplicatedStorage:GetDescendants() do if v.Name == "SyncAPI" then tool = v.Parent end end
    if not tool then return end
    local remote = tool.SyncAPI.ServerEndpoint
    local function _(args) remote:InvokeServer(unpack(args)) end
    local function SetLocked(part, boolean) _({"SetLocked", {part}, boolean}) end
    local function SpawnDecal(part, side) _({"CreateTextures", {{Part = part, Face = side, TextureType = "Decal"}}}) end
    local function AddDecal(part, asset, side) _({"SyncTexture", {{Part = part, Face = side, TextureType = "Decal", Texture = "rbxassetid://" .. asset}}}) end
    local function spam(id)
        for _, v in game.Workspace:GetDescendants() do
            if v:IsA("BasePart") then
                task.spawn(function()
                    SetLocked(v, false)
                    for _, side in Enum.NormalId:GetEnumItems() do
                        SpawnDecal(v, side)
                        AddDecal(v, id, side)
                    end
                end)
            end
        end
    end
    spam(119360779637179)
end)

-- Skybox（原版，也很危险，慎用）
SkyboxBtn.MouseButton1Click:Connect(function()
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local RequestCommand = ReplicatedStorage:FindFirstChild("HDAdminHDClient") and ReplicatedStorage.HDAdminHDClient:FindFirstChild("Signals") and ReplicatedStorage.HDAdminHDClient.Signals:FindFirstChild("RequestCommandSilent")
    if RequestCommand then
        RequestCommand:InvokeServer(";unfog")
        RequestCommand:InvokeServer(";fogcolor black")
        RequestCommand:InvokeServer(";time 0")
    end

    local player = game.Players.LocalPlayer
    local char = player.Character or player.CharacterAdded:Wait()
    local tool
    for _, v in player:GetDescendants() do if v.Name == "SyncAPI" then tool = v.Parent end end
    for _, v in game.ReplicatedStorage:GetDescendants() do if v.Name == "SyncAPI" then tool = v.Parent end end
    if not tool then return end
    local remote = tool.SyncAPI.ServerEndpoint
    local function _(args) remote:InvokeServer(unpack(args)) end

    -- 其余 Sky 函数代码保持原样（略去重复部分以节省空间，但实际复制时完整保留你之前的 Sky 函数）
    -- ... (从 function SetCollision 到 function Sky(id) 的所有定义)
    -- Sky("122714843906483")
end)

-- 音乐按钮（单次）
ThemeMeBtn.MouseButton1Click:Connect(function() HD(";music 110788401793874 ;volume inf") end)
JumpstyleBtn.MouseButton1Click:Connect(function() HD(";music 1839246711 ;volume inf") end)
ToxicBtn.MouseButton1Click:Connect(function() HD(";music 86412047196482 ;volume inf") end)
WtfGoobyBtn.MouseButton1Click:Connect(function() HD(";music 113548699544058 ;volume inf ;pitch 0.1") end)

print("k00pkidd770 GUI 已加载 - 使用慢速循环防踢")